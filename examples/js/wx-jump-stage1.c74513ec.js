(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["wx-jump-stage1"],{"8bb1":function(e,t,i){},a56b:function(e,t,i){"use strict";var r=i("8bb1"),a=i.n(r);a.a},e424:function(e,t,i){"use strict";i.r(t);var r=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},a=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"jump-world"},[i("canvas",{attrs:{id:"jump-world-canvas"}})])}],n=(i("ac6a"),i("768b")),o=i("d225"),s=i("b0b4"),h=i("5a89"),c=i("22b5"),u=Math.random,l=Math.sqrt,p=Math.floor,d=Math.pow,g=Math.sin,v=Math.cos,f=Math.tan,y=Math.PI;function m(e,t,i,r,a,n){var o=e*(y/180),s=t*(y/180),h=v(o)*r,c=g(o)*(n-a-i/f(o));if(!(h>c)){var u=h+(c-h)/2,l=u/f(o),p=g(s)*l,d=v(s)*l;return{x:p,y:u,z:d}}console.warn("警告: 垂直角度太小了!")}var w=new h["MeshLambertMaterial"],b=new h["BoxBufferGeometry"],S=function(e){return e[p(u()*e.length)]},P=function(e,t){return p(u()*(t-e+1))+e},x=function e(t){var i=e.box3||(e.box3=new h["Box3"]);return i.setFromObject(t),i.getSize(new h["Vector3"])},z=function(e,t,i){var r=g(2*t),a=g(t),n=d(e,2)*r/i,o=d(e*a,2)/(2*i);return{rangeR:n,rangeH:o}},O=function(e,t,i){var r=t.x,a=t.z,n=i.x,o=i.z,s=n-r,h=o-a,c=l(d(h,2)+d(s,2)),u=s*e/c,p=h*e/c;return{jumpDownX:r+u,jumpDownZ:a+p}},j=function(e,t,i){var r=e.from,a=e.to,n=e.duration,o=e.easing,s=void 0===o?function(e){return e}:o,h=e.autoStart,u=void 0===h||h,l=new c["a"].Tween(r).to(a,n).easing(s).onUpdate(t).onComplete((function(){i&&i()}));return u&&l.start(),k(),l},k=function e(){if(!e.openin){e.openin=!0;var t=function t(){var i=requestAnimationFrame(t);c["a"].update()||(e.openin=!1,cancelAnimationFrame(i))};t()}},C=(i("8e6e"),i("456d"),i("bd86"));function M(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function Y(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?M(i,!0).forEach((function(t){Object(C["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):M(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var H=function(){function e(t){var i=t.width,r=t.height,a=t.canvas,n=t.axesHelper,s=void 0!==n&&n,h=t.cameraNear,c=t.cameraFar,u=t.cameraInitalPosition,l=t.lightInitalPosition;Object(o["a"])(this,e),this.width=i,this.height=r,this.canvas=a,this.axesHelper=s,this.cameraNear=h,this.cameraFar=c,this.cameraInitalPosition=u,this.lightInitalPosition=l,this.scene=null,this.plane=null,this.light=null,this.camera=null,this.renderer=null,this.init()}return Object(s["a"])(e,[{key:"init",value:function(){this.createScene(),this.createPlane(),this.createLight(),this.createCamera(),this.createRenterer(),this.render()}},{key:"createScene",value:function(){var e=this.scene=new h["Scene"];e.background=new h["Color"](14080991),this.axesHelper&&e.add(new h["AxesHelper"](1e4))}},{key:"createPlane",value:function(){var e=this.scene,t=new h["PlaneBufferGeometry"](1e3,1e3,1,1),i=new h["ShadowMaterial"];i.opacity=.5;var r=this.plane=new h["Mesh"](t,i);r.rotation.x=-.5*Math.PI,r.position.y=-.1,r.receiveShadow=!0,e.add(r)}},{key:"createLight",value:function(){var e=this.scene,t=this.lightInitalPosition,i=t.x,r=t.y,a=t.z,n=this.height,o=this.light=new h["DirectionalLight"](16777215,.5),s=this.lightTarget=new h["Object3D"];o.target=s,o.position.set(i,r,a),o.castShadow=!0,o.shadow.camera.left=-n,o.shadow.camera.right=n,o.shadow.camera.top=n,o.shadow.camera.bottom=-n,o.shadow.camera.near=0,o.shadow.camera.far=2e3,o.shadow.mapSize.width=1600,o.shadow.mapSize.height=1600,e.add(new h["AmbientLight"](15067113,.4)),e.add(new h["HemisphereLight"](16777215,16777215,.2)),e.add(s),e.add(o)}},{key:"createCamera",value:function(){var e=this.scene,t=this.width,i=this.height,r=this.cameraInitalPosition,a=r.x,n=r.y,o=r.z,s=this.cameraNear,c=this.cameraFar,u=this.camera=new h["OrthographicCamera"](-t/2,t/2,i/2,-i/2,s,c);u.position.set(a,n,o),u.lookAt(e.position),e.add(u)}},{key:"createRenterer",value:function(){var e=this.canvas,t=this.width,i=this.height,r=this.renderer=new h["WebGLRenderer"]({canvas:e,alpha:!0,antialias:!0});r.setSize(t,i),r.shadowMap.enabled=!0,r.setPixelRatio(window.devicePixelRatio)}},{key:"render",value:function(){var e=this.scene,t=this.camera;this.renderer.render(e,t)}},{key:"moveCamera",value:function(e,t,i){var r=this,a=e.cameraTo,n=e.center,o=e.lightTo,s=this.camera,h=this.plane,c=this.light,u=this.lightTarget,l=this.lightInitalPosition;j({from:Y({},s.position),to:a,duration:i},(function(e){var t=e.x,i=(e.y,e.z);s.position.x=t,s.position.z=i,r.render()}),t);var p=l.x,d=l.z;j({from:Y({},c.position),to:o,duration:i},(function(e){var t=e.x,i=e.y,r=e.z;u.position.x=t-p,u.position.z=r-d,c.position.set(t,i,r)})),h.position.x=n.x,h.position.z=n.z}},{key:"add",value:function(){var e;return(e=this.scene).add.apply(e,arguments)}},{key:"remove",value:function(){var e;return(e=this.scene).remove.apply(e,arguments)}}]),e}(),D=H,R=0,T=[6799930,15114812,16084076,9474969,4235007,16777215],G=[],I=[function(e,t){var i=Object(n["a"])(t.propSizeRange,2),r=i[0],a=i[1],o=t.propHeight,s=t.baseMeshLambertMaterial,h=t.baseBoxBufferGeometry;++R;var c=S(T),u=R<3?a:P(r,a),l=h.clone();l.scale(u,o,u);var p=s.clone();return p.setValues({color:c}),new e.Mesh(l,p)}],L=function(){function e(t){var i=t.propHeight,r=t.propSizeRange,a=t.needDefaultCreator;Object(o["a"])(this,e),this.propHeight=i,this.propSizeRange=r,this.propCreators=[],a&&(this.createPropCreator(I,!1),this.createPropCreator(G,!0))}return Object(s["a"])(e,[{key:"createProp",value:function(e){var t=this.propCreators;return e>-1&&t[e]&&t[e]()||S(t)()}},{key:"createPropCreator",value:function(e,t){var i=this;if(Array.isArray(e))e.forEach((function(e){return i.createPropCreator(e,t)}));else{var r=this.propCreators,a=this.propSizeRange,n=this.propHeight;if(!(r.indexOf(e)>-1)){var o=function i(){if(t&&i.box)return i.box.clone();var r=e(h,{propSizeRange:a,propHeight:n,baseMeshLambertMaterial:w,baseBoxBufferGeometry:b});return t&&(i.box=r),r};r.push(o)}}}}]),e}(),E=L,B=i("75fc"),V=function(){function e(t){var i=t.world,r=t.stage,a=t.body,n=t.height,s=t.enterHeight,h=t.distanceRange,c=t.prev;Object(o["a"])(this,e),this.world=i,this.stage=r,this.body=a,this.height=n,this.enterHeight=s,this.distanceRange=h,this.prev=c}return Object(s["a"])(e,[{key:"computeMyPosition",value:function(){var e=this.world,t=this.prev,i=this.distanceRange,r=this.enterHeight,a={x:0,y:r,z:0};if(!t)return a;if(0===r)return a.z=e.width/2,a;var n=t.getPosition(),o=n.x,s=n.z,h=0===Math.round(Math.random()),c=t.getSize(),u=c.x,l=c.z,p=this.getSize(),d=p.x,g=p.z,v=P.apply(void 0,Object(B["a"])(i));return h?(a.x=o+u/2+v+d/2,a.z=s):(a.x=o,a.z=s+l/2+v+g/2),a}},{key:"enterStage",value:function(){var e=this.stage,t=this.body,i=this.height,r=this.computeMyPosition(),a=r.x,n=r.y,o=r.z;t.castShadow=!0,t.receiveShadow=!0,t.position.set(a,n,o),t.geometry.translate(0,i/2,0),e.add(t),e.render(),this.entranceTransition()}},{key:"entranceTransition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:400,t=this.body,i=this.enterHeight,r=this.stage;0!==i&&j({to:{y:0},from:{y:i},duration:e,easing:c["a"].Easing.Bounce.Out},(function(e){var i=e.y;t.position.setY(i),r.render()}))}},{key:"springbackTransition",value:function(e){var t=this.body,i=this.stage,r=t.scale.y;j({from:{y:r},to:{y:1},duration:e,easing:c["a"].Easing.Bounce.Out},(function(e){var r=e.y;t.scale.setY(r),i.render()}))}},{key:"setNext",value:function(e){this.next=e}},{key:"getNext",value:function(e){return this.next}},{key:"getPosition",value:function(){return this.body.position}},{key:"setPosition",value:function(e,t,i){return this.body.position.set(e,t,i)}},{key:"scaleY",value:function(e){return this.body.scale.setY(e)}},{key:"getSize",value:function(){return x(this.body)}},{key:"dispose",value:function(){var e=this.body,t=this.stage,i=this.prev,r=this.next;this.prev=null,this.next=null,i&&(i.next=null),r&&(r.prev=null),e.geometry.dispose(),e.material.dispose(),t.remove(e)}}]),e}(),X=V;function Z(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function N(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Z(i,!0).forEach((function(t){Object(C["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Z(i).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var A=function(){function e(t){var i=t.world,r=t.color,a=t.G;Object(o["a"])(this,e),this.world=i,this.color=r,this.G=a,this.v0=i.width/10,this.theta=90,this.headSegment=null,this.bodyScaleSegment=null,this.bodyRotateSegment=null,this.body=null,this.currentProp=null,this.nextProp=null,this.powerStorageDuration=1500,this.stage=null,this.createBody(),this.resetPowerStorageParameter()}return Object(s["a"])(e,[{key:"bindEvent",value:function(){var e=this,t=this.world.container,i="ontouchstart"in document,r=i?"touchstart":"mousedown",a=i?"touchend":"mouseup",n=function i(){e.jumping||(e.jumping=!0,e.poweringUp=!1,e.jump(),t.removeEventListener(a,i))},o=function(i){i.preventDefault(),e.poweringUp||e.jumping||!e.currentProp||(e.poweringUp=!0,e.powerStorage(),t.addEventListener(a,n,!1))};t.addEventListener(r,o,!1)}},{key:"createBody",value:function(){var e=this.color,t=this.world.width,i=w.clone();i.setValues({color:e});var r=this.headSize=.03*t,a=this.headTranslateY=4.5*r,n=new h["SphereGeometry"](r,40,40),o=this.headSegment=new h["Mesh"](n,i);o.castShadow=!0,o.translateY(a),this.bodySize=4.5*r;var s=new h["CylinderBufferGeometry"](.9*r,1.2*r,2.5*r,40);s.translate(0,1.25*r,0);var c=new h["CylinderBufferGeometry"](r,.9*r,r,40);c.translate(0,3*r,0);var u=new h["SphereGeometry"](r,40,40);u.translate(0,3.5*r,0);var l=new h["Geometry"];l.merge(u),l.merge((new h["Geometry"]).fromBufferGeometry(c)),l.merge((new h["Geometry"]).fromBufferGeometry(s));var p=this.bodyScaleSegment=new h["Mesh"](l,i);p.castShadow=!0,p.translateY(-20);var d=this.bodyRotateSegment=new h["Group"];d.add(o),d.add(p),d.translateY(20);var g=this.body=new h["Group"];g.add(d)}},{key:"enterStage",value:function(e,t,i){var r=t.x,a=t.y,n=t.z,o=this.body;o.position.set(r,a,n),this.stage=e,this.nextProp=i,e.add(o),e.render(),this.bindEvent()}},{key:"resetPowerStorageParameter",value:function(){this.toValues={headTranslateY:0,bodyScaleXZ:0,bodyScaleY:0},this.fromValues=this.fromValues||{headTranslateY:this.headTranslateY,bodyScaleXZ:1,bodyScaleY:1,propScaleY:1}}},{key:"powerStorage",value:function(){var e=this,t=this.stage,i=this.powerStorageDuration,r=this.body,a=this.bodyScaleSegment,n=this.headSegment,o=this.bodySize,s=this.fromValues,h=this.currentProp,c=this.world.propHeight;this.powerStorageTime=Date.now(),this.resetPowerStorageParameter();var u=j({from:N({},s),to:{headTranslateY:o-.6*o,bodyScaleXZ:1.3,bodyScaleY:.6,propScaleY:.6},duration:i},(function(i){var o=i.headTranslateY,s=i.bodyScaleXZ,l=i.bodyScaleY,p=i.propScaleY;e.poweringUp?(n.position.setY(o),a.scale.set(s,l,s),h.scaleY(p),r.position.setY(c*p),e.toValues={headTranslateY:o,bodyScaleXZ:s,bodyScaleY:l},t.render()):u.stop()}))}},{key:"computePowerStorageValue",value:function(){var e=this.powerStorageDuration,t=this.powerStorageTime,i=this.v0,r=this.theta,a=Date.now()-t,n=Math.min(a,e),o=n/e;return{v0:i+30*o,theta:r-40*o}}},{key:"jump",value:function(){var e=this,t=this.stage,i=this.body,r=this.currentProp,a=this.nextProp,n=this.world.propHeight,o=400,s=i.position,h=a.getPosition(),u=s.x,l=s.y,p=s.z;if(r||u!==h.x||p!==h.z){if(!r)return;var d=this.bodyScaleSegment,g=this.headSegment,v=this.G,f=(this.headTranslateY,this.computePowerStorageValue()),y=f.v0,m=f.theta,w=z(y,m*(Math.PI/180),v),b=w.rangeR,S=w.rangeH,P=O(b,s,h),x=P.jumpDownX,k=P.jumpDownZ;j({from:N({x:u,z:p},this.toValues),to:N({x:x,z:k},this.fromValues),duration:o},(function(e){var t=e.x,r=e.z,a=e.headTranslateY,n=e.bodyScaleXZ,o=e.bodyScaleY;i.position.setX(t),i.position.setZ(r),g.position.setY(a),d.scale.set(n,o,n)}));var C=Math.max(this.world.width/3,S)+n,M=j({from:{y:l},to:{y:C},duration:.65*o,easing:c["a"].Easing.Cubic.Out,autoStart:!1},(function(e){var t=e.y;i.position.setY(t)})),Y=j({from:{y:C},to:{y:n},duration:.35*o,easing:c["a"].Easing.Cubic.In,autoStart:!1},(function(e){var t=e.y;i.position.setY(t)})),H=function(){var t=e.world;t.createProp(),t.moveCamera(),e.currentProp=a,e.nextProp=a.getNext(),e.jumping=!1},D=j({from:{s:.8},to:{s:1},duration:100,autoStart:!1},(function(e){var t=e.s;d.scale.setY(t)}),(function(){H()}));Y.chain(D),M.chain(Y).start();var R=r.getPosition().z===a.getPosition().z;this.flip(o,R),r.springbackTransition(500)}else j({from:{y:l},to:{y:n},duration:o,easing:c["a"].Easing.Bounce.Out},(function(e){var r=e.y;i.position.setY(r),t.render()}),(function(){e.currentProp=a,e.nextProp=a.getNext(),e.jumping=!1}));t.render()}},{key:"flip",value:function(e,t){var i=this.bodyRotateSegment,r=0;j({from:{deg:0},to:{deg:360},duration:e,easing:c["a"].Easing.Sinusoidal.InOut},(function(e){var a=e.deg;t?i.rotateZ(-(a-r)*(Math.PI/180)):i.rotateX((a-r)*(Math.PI/180)),r=a}))}}]),e}(),F=A,q=function(){function e(t){var i=t.container,r=t.canvas,a=t.needDefaultCreator,n=void 0===a||a,s=t.axesHelper,h=void 0!==s&&s;Object(o["a"])(this,e);var c=i.offsetWidth,u=i.offsetHeight;this.G=9.8,this.container=i,this.canvas=r,this.width=c,this.height=u,this.needDefaultCreator=n,this.axesHelper=h;var l=~~(c/6),p=~~(c/3.5);this.propSizeRange=[l,p],this.propHeight=~~(p/2),this.propDistanceRange=[~~(l/2),2*p],this.stage=null,this.propCreator=null,this.init()}return Object(s["a"])(e,[{key:"init",value:function(){this.initStage(),this.initPropCreator(),this.computeSafeClearLength(),this.createProp(0),this.createProp(0),this.moveCamera(0),this.initLittleMan()}},{key:"initStage",value:function(){this.container;var e=this.canvas,t=this.axesHelper,i=this.width,r=this.height,a=.1,n=2e3,o=this.cameraInitalPosition=m(35,225,r/2,r/2,a,n),s=this.lightInitalPosition={x:-300,y:600,z:200};this.stage=new D({width:i,height:r,canvas:e,axesHelper:t,cameraNear:a,cameraFar:n,cameraInitalPosition:o,lightInitalPosition:s})}},{key:"initPropCreator",value:function(){var e=this.needDefaultCreator,t=this.propSizeRange,i=this.propHeight;this.props=[],this.propCreator=new E({propHeight:i,propSizeRange:t,needDefaultCreator:e})}},{key:"createPropCreator",value:function(){var e;(e=this.propCreator).createPropCreator.apply(e,arguments)}},{key:"initLittleMan",value:function(){var e=this.stage,t=this.propHeight,i=this.G,r=this.props,a=this.littleMan=new F({world:this,color:3696793,G:i});a.enterStage(e,{x:0,y:t+80,z:0},r[0]),a.jump()}},{key:"createProp",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,t=(this.height,this.propCreator),i=this.propHeight,r=Object(n["a"])(this.propSizeRange,2),a=r[0],o=r[1],s=this.propDistanceRange,h=this.stage,c=this.props,u=this.props.length,l=c[u-1],p=new X({world:this,stage:h,body:t.createProp(u<3?0:-1),height:i,prev:l,enterHeight:e,distanceRange:s}),d=p.getSize();d.y!==i&&console.warn("高度: ".concat(d.y,",盒子高度必须为 ").concat(i)),(d.x<a||d.x>o)&&console.warn("宽度: ".concat(d.x,", 盒子宽度必须为 ").concat(a," - ").concat(o)),(d.z<a||d.z>o)&&console.warn("深度: ".concat(d.z,", 盒子深度度必须为 ").concat(a," - ").concat(o)),l&&l.setNext(p),p.enterStage(),c.push(p)}},{key:"moveCamera",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500,i=this.stage,r=this.height,a=this.cameraInitalPosition,n=a.x,o=a.y,s=a.z,h=this.lightInitalPosition,c=h.x,u=h.y,l=h.z,p=r/10,d=this.getLastTwoCenterPosition(),g=d.x,v=d.y,f=d.z,y={x:g+n+p,y:o,z:f+s+p},m={x:g+c,y:u,z:f+l},w={cameraTo:y,lightTo:m,center:{x:g,y:v,z:f}};i.moveCamera(w,(function(){e.clearProps()}),t)}},{key:"getLastTwoCenterPosition",value:function(){var e=this.props,t=this.props.length,i=e[t-2].getPosition(),r=i.x,a=i.z,n=e[t-1].getPosition(),o=n.x,s=n.z;return{x:r+(o-r)/2,z:a+(s-a)/2}}},{key:"clearProps",value:function(){this.width,this.height;var e=this.safeClearLength,t=this.props,i=(this.stage,this.props.length),r=4;i>e&&(t.slice(0,r).forEach((function(e){return e.dispose()})),this.props=t.slice(r))}},{key:"computeSafeClearLength",value:function(){var e=this.width,t=this.height,i=this.propSizeRange,r=i[0],a=Math.sqrt(r*r+r*r);this.safeClearLength=Math.ceil(e/r)+Math.ceil(t/a/2)+1}}]),e}(),U=q,_={mounted:function(){new U({container:document.querySelector(".jump-world"),canvas:document.querySelector("#jump-world-canvas"),axesHelper:!0})}},J=_,W=(i("a56b"),i("2877")),$=Object(W["a"])(J,r,a,!1,null,"0bf23ea4",null);t["default"]=$.exports}}]);